<div id="section-topbar" class>
	<div id="topbar-inner">
		<div class="container">
			<div class="row">
				<div class="dropdown">
					<ul id="nav" class="nav">
						<li class="menu-item"><a class="smoothScroll" href="/" title="홈으로"><i class="fa fa-home"></i></a></li>
						<li class="menu-item"><a class="smoothScroll" href="/map" title="지도보기"><i class="fa fa-map-o"></i></a></li>
						<li class="menu-item"><a class="smoothScroll" href="/new" title="신고하기"><i class="fa fa-map-marker"></i></a></li>
						<li class="menu-item"><a class="smoothScroll" href="#contact" title="Contact"><i class="icon-envelope"></i></a></li>
					</ul><!--/ uL#nav -->
				</div><!-- /.dropdown -->

				<div class="clear"></div>
			</div><!--/.row -->
		</div><!--/.container -->

		<div class="clear"></div>
	</div><!--/ #topbar-inner -->
</div><!--/ #section-topbar -->

<div id="map" class="map_container col-md-12 col-xs-12 col-sm-12"></div>



<div class="form-group">
    <form>
         <input type="text" class="form-control" placeholder="Search" id="searching">
        <button id="clickme" type="submit" class="">Submit</button>
    </form>
</div>


<!-- side menu  -->

<!--<div id="wrapper">-->
<!--    <div class="overlay"></div>-->

    <!-- Sidebar -->
<!--    <nav class="navbar navbar-inverse navbar-fixed-top" id="sidebar-wrapper" role="navigation">-->
<!--        <ul class="nav sidebar-nav">-->
<!--            <li class="sidebar-brand">-->
<!--                <a href="#">-->
<!--                   Brand-->
<!--                </a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">Home</a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">About</a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">Events</a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">Team</a>-->
<!--            </li>-->
<!--            <li class="dropdown">-->
<!--              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Works <span class="caret"></span></a>-->
<!--              <ul class="dropdown-menu" role="menu">-->
<!--                <li class="dropdown-header">Dropdown heading</li>-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--                <li><a href="#">One more separated link</a></li>-->
<!--              </ul>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">Services</a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="#">Contact</a>-->
<!--            </li>-->
<!--            <li>-->
<!--                <a href="https://twitter.com/maridlcrmn">Follow me</a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </nav>-->
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
<!--    <div id="page-content-wrapper">-->
<!--        <button type="button" class="hamburger is-closed" data-toggle="offcanvas">-->
<!--            <span class="hamb-top"></span>-->
<!--			<span class="hamb-middle"></span>-->
<!--			<span class="hamb-bottom"></span>-->
<!--        </button>-->
<!--        <div class="container">-->
<!--            <div class="row">-->
<!--                <div class="col-lg-8 col-lg-offset-2">-->
<!--                    <h1>Fancy Toggle Sidebar Navigation</h1>-->
<!--                    <p>Bacon ipsum dolor sit amet tri-tip shoulder tenderloin shankle. Bresaola tail pancetta ball tip doner meatloaf corned beef. Kevin pastrami tri-tip prosciutto ham hock pork belly bacon pork loin salami pork chop shank corned beef tenderloin meatball cow. Pork bresaola meatloaf tongue, landjaeger tail andouille strip steak tenderloin sausage chicken tri-tip. Pastrami tri-tip kielbasa sausage porchetta pig sirloin boudin rump meatball andouille chuck tenderloin biltong shank </p>-->
<!--                    <p>Pig meatloaf bresaola, spare ribs venison short loin rump pork loin drumstick jowl meatball brisket. Landjaeger chicken fatback pork loin doner sirloin cow short ribs hamburger shoulder salami pastrami. Pork swine beef ribs t-bone flank filet mignon, ground round tongue. Tri-tip cow turducken shank beef shoulder bresaola tongue flank leberkas ball tip.</p>-->
<!--                    <p>Filet mignon brisket pancetta fatback short ribs short loin prosciutto jowl turducken biltong kevin pork chop pork beef ribs bresaola. Tongue beef ribs pastrami boudin. Chicken bresaola kielbasa strip steak biltong. Corned beef pork loin cow pig short ribs boudin bacon pork belly chicken andouille. Filet mignon flank turkey tongue. Turkey ball tip kielbasa pastrami flank tri-tip t-bone kevin landjaeger capicola tail fatback pork loin beef jerky.</p>-->
<!--                    <p>Chicken ham hock shankle, strip steak ground round meatball pork belly jowl pancetta sausage spare ribs. Pork loin cow salami pork belly. Tri-tip pork loin sausage jerky prosciutto t-bone bresaola frankfurter sirloin pork chop ribeye corned beef chuck. Short loin hamburger tenderloin, landjaeger venison porchetta strip steak turducken pancetta beef cow leberkas sausage beef ribs. Shoulder ham jerky kielbasa. Pig doner short loin pork chop. Short ribs frankfurter rump meatloaf.</p>-->
<!--                    <p>Filet mignon biltong chuck pork belly, corned beef ground round ribeye short loin rump swine. Hamburger drumstick turkey, shank rump biltong pork loin jowl sausage chicken. Rump pork belly fatback ball tip swine doner pig. Salami jerky cow, boudin pork chop sausage tongue andouille turkey.</p>                         -->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
    <!-- /#page-content-wrapper -->

<!--</div>-->
<!-- /#wrapper -->

<!--footer -->
<!--<div id="wrap_footer">-->

  <!-- Begin page content -->
<!--  <div class="container">-->
<!--    <div class="page-header">-->
<!--      <h1>Footer dropup</h1>-->
<!--    </div>-->
<!--    <p>Just an drop-up for use in footer or somewhere else.</p>-->
<!--  </div>-->
<!--</div>-->

<!--<div id="footer">-->
<!--  <div class="container">-->
<!--    <p class="text-muted credit">-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="btn-group">-->
<!--            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">-->
<!--                Dropup <span class="caret caret-up"></span>-->
<!--            </button>-->
<!--            <ul class="dropdown-menu drop-up" role="menu">-->
<!--                <li><a href="#">Action</a></li>-->
<!--                <li><a href="#">Another action</a></li>-->
<!--                <li><a href="#">Something else here</a></li>-->
<!--                <li class="divider"></li>-->
<!--                <li><a href="#">Separated link</a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--    </p>-->
<!--  </div>-->
<!--</div>-->



<script>

var map = new naver.maps.Map('map', mapOptions);
var mapOptions = {
    center: new naver.maps.LatLng(37.3595704, 127.105399), //지도의 초기 중심 좌표
    zoom: 13, //지도의 초기 줌 레벨
    minZoom: 1, //지도의 최소 줌 레벨
    scaleControl: true,
    logoControl: true,
    mapDataControl: true,
    zoomControl: true, //줌 컨트롤의 표시 여부
    zoomControlOptions: { //줌 컨트롤의 옵션
    position: naver.maps.Position.TOP_RIGHT
}};

//marker option
var menuLayer = $('<div style="position:absolute;z-index:10000;background-color:#fff;border:solid 1px #333;padding:10px;display:none;"></div>');

map.getPanes().floatPane.appendChild(menuLayer[0]);

var markerList = [];
var infowindowList =[];

<% @barbaries.each do |bar| %>
<% if bar.x||bar.y != nil %>

    var marker_bar = new naver.maps.Marker({
        position: new naver.maps.LatLng(<%= bar.x %>,<%= bar.y %>),
        map: map,
        shape: {
            coords: [11, 0, 9, 0, 6, 1, 4, 2, 2, 4,
                    0, 8, 0, 12, 1, 14, 2, 16, 5, 19,
                    5, 20, 6, 23, 8, 26, 9, 30, 9, 34,
                    13, 34, 13, 30, 14, 26, 16, 23, 17, 20,
                    17, 19, 20, 16, 21, 14, 22, 12, 22, 12,
                    22, 8, 20, 4, 18, 2, 16, 1, 13, 0],
            type: 'poly'
        }
    });
        
    var contentString = [
            '<div class="iw_inner">',
            '   <h5> <%= bar.title %></h5>',
            '<button> Click me</button>',
            '   </p>',
            '</div>'
        ].join('');
    
    var infowindow_bar = new naver.maps.InfoWindow({
        content: contentString,
        maxWidth: 140,
        // backgroundColor: "#eee",
        // // borderColor: "#2db400",
        // borderWidth: 5,
        // anchorSize: new naver.maps.Size(30, 30),
        // anchorSkew: true,
        // anchorColor: "#eee",
        // pixelOffset: new naver.maps.Point(20, -20)
    });    
        
    markerList.push(marker_bar);
    infowindowList.push(infowindow_bar);

    <% end %>
<% end %>


// 해당 마커의 인덱스를 seq라는 클로저 변수로 저장하는 이벤트 핸들러를 반환합니다.
function getClickHandler(seq) {
    return function(e) {
        var marker = markerList[seq],
            infoWindow = infowindowList[seq];

        if (infoWindow.getMap()) {
            infoWindow.close();
        } else {
            infoWindow.open(map, marker);
        }
    }
}

for (var i=0, ii=markerList.length; i<ii; i++) {
    naver.maps.Event.addListener(markerList[i], 'click', getClickHandler(i));
}



naver.maps.Event.addListener(map, 'rightclick', function(e) {
    var coordHtml = 'Coord: '+ e.coord +'<br />Point: '+ e.point +'<br />Offset: '+ e.offset;

    menuLayer.show().css({
        left: e.offset.x,
        top: e.offset.y
    }).html(coordHtml);
});




//setOptions 메서드를 통해 옵션을 조정할 수도 있습니다.
map.setOptions("mapTypeControl", true); //지도 유형 컨트롤의 표시 여부


// 지도 인터랙션 옵션
$("#interaction").on("click", function(e) {
    e.preventDefault();

    if (map.getOptions("draggable")) {
        map.setOptions({ //지도 인터랙션 끄기
            draggable: false,
            pinchZoom: false,
            scrollWheel: false,
            keyboardShortcuts: false,
            disableDoubleTapZoom: true,
            disableDoubleClickZoom: true,
            disableTwoFingerTapZoom: true
        });

        $(this).removeClass("control-on");
    } else {
        map.setOptions({ //지도 인터랙션 켜기
            draggable: true,
            pinchZoom: true,
            scrollWheel: true,
            keyboardShortcuts: true,
            disableDoubleTapZoom: false,
            disableDoubleClickZoom: false,
            disableTwoFingerTapZoom: false
        });

        $(this).addClass("control-on");
    }
});

// 관성 드래깅 옵션
$("#kinetic").on("click", function(e) {
    e.preventDefault();

    if (map.getOptions("disableKineticPan")) {
        map.setOptions("disableKineticPan", false); //관성 드래깅 켜기
        $(this).addClass("control-on");
    } else {
        map.setOptions("disableKineticPan", true); //관성 드래깅 끄기
        $(this).removeClass("control-on");
    }
});

// 타일 fadeIn 효과
$("#tile-transition").on("click", function(e) {
    e.preventDefault();

    if (map.getOptions("tileTransition")) {
        map.setOptions("tileTransition", false); //타일 fadeIn 효과 끄기

        $(this).removeClass("control-on");
    } else {
        map.setOptions("tileTransition", true); //타일 fadeIn 효과 켜기
        $(this).addClass("control-on");
    }
});

// min/max 줌 레벨
$("#min-max-zoom").on("click", function(e) {
    e.preventDefault();

    if (map.getOptions("minZoom") === 10) {
        map.setOptions({
            minZoom: 1,
            maxZoom: 14
        });
        $(this).val(this.name + ': 1 ~ 14');
    } else {
        map.setOptions({
            minZoom: 10,
            maxZoom: 12
        });
        $(this).val(this.name + ': 10 ~ 12');
    }
});

//지도 컨트롤
$("#controls").on("click", function(e) {
    e.preventDefault();

    if (map.getOptions("scaleControl")) {
        map.setOptions({ //모든 지도 컨트롤 숨기기
            scaleControl: false,
            logoControl: false,
            mapDataControl: false,
            zoomControl: false,
            mapTypeControl: false
        });
        $(this).removeClass('control-on');
    } else {
        map.setOptions({ //모든 지도 컨트롤 보이기
            scaleControl: true,
            logoControl: true,
            mapDataControl: true,
            zoomControl: true,
            mapTypeControl: true
        });
        $(this).addClass('control-on');
    }
});

$("#interaction, #tile-transition, #controls").addClass("control-on");

//GPS 중심 map location

function onSuccessGeolocation(position) {
    var location = new naver.maps.LatLng(position.coords.latitude,
                                         position.coords.longitude);
    <% if params[:juso_x] || params[:juso_y] != nil %>
    location = new naver.maps.LatLng(<%= params[:juso_x] %>,<%= params[:juso_y] %>);
    <% end %>

    map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.
    map.setZoom(12); // 지도의 줌 레벨을 변경합니다.
}

    // if(location !== null){
    // map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.
    // map.setZoom(12); // 지도의 줌 레벨을 변경합니다.
    // } else{
    // location = new naver.maps.LatLng(position.coords.latitude,
    //                                      position.coords.longitude);
    // map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.
    // map.setZoom(12); // 지도의 줌 레벨을 변경합니다.
    // }
// }

function onErrorGeolocation() {
    var center = map.getCenter();

}

$(window).on("load", function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
    } else {
        var center = map.getCenter();

    }
});

$("#clickme").click(function(){
    search_juso = $("#searching").val();
    $.ajax({
        method: "POST",
        url: "/search",
        data: {'juso' :search_juso},
        }).done(function() {
        <% if params[:juso_x] || params[:juso_y] != nil %>
        var location = new naver.maps.LatLng(<%= params[:juso_x] %>,<%= params[:juso_y] %>);
        <% end %>
        map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.
        map.setZoom(12); // 지도의 줌 레벨을 변경합니다.
    });
});



</script>

